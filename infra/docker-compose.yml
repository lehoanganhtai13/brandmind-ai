version: '3.8'

services:
  # SearXNG - Privacy-focused search engine
  searxng:
    image: searxng/searxng:2025.10.25-4ca75a045
    container_name: searxng_container
    hostname: searxng
    restart: unless-stopped
    volumes:
      - ./services/searxng/data:/etc/searxng
    ports:
      - "${SEARXNG_PORT:-8080}:8080"
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://127.0.0.1:8080 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - brandmind-network

  # Crawl4AI - Web scraping service
  crawl4ai:
    image: unclecode/crawl4ai:0.7.6
    container_name: crawl4ai-server
    ports:
      - "${CRAWL4AI_PORT:-11235}:11235"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:11235/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - brandmind-network

  # FalkorDB - Graph database for GraphRAG and knowledge graphs
  falkordb:
    hostname: falkordb
    container_name: falkordb-container
    image: falkordb/falkordb:v4.14.8
    restart: unless-stopped
    ports:
      - "${FALKORDB_PORT:-6380}:6379"
      - "${FALKORDB_BROWSER_PORT:-3000}:3000"
    environment:
      - FALKORDB_USERNAME=${FALKORDB_USERNAME:-brandmind}
      - FALKORDB_PASSWORD=${FALKORDB_PASSWORD:-password}
    volumes:
      - falkordb-data:/data
      - ./services/falkordb/conf/falkordb.conf.template:/usr/local/etc/falkordb/falkordb.conf.template:ro
      - ./services/falkordb/docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh:ro
    entrypoint: ["/usr/local/bin/docker-entrypoint.sh"]
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - brandmind-network

volumes:
  falkordb-data:

networks:
  brandmind-network:
    driver: bridge